col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'averaged spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
corrected[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.1),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'corrected spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
sample <- unlist(na.omit(metadata$sample))
library(readxl)
metadata <- read_excel("metadata.xlsx")
sample <- unlist(na.omit(metadata$sample))
sample <- as.character(sample)
for(i in 1:5){
index1[[i]] <- which(grepl(paste0('(?=.*',search1[i],')'),rownames(mean),perl = T))
}
search1 <- as.character(c(131,149,161,164,167))
index1 <- list(5)
for(i in 1:5){
index1[[i]] <- which(grepl(paste0('(?=.*',search1[i],')'),rownames(mean),perl = T))
}
index1
delete.index1 <- list(5)
for(i in 1:5){
delete.index1[i] <- which(sample == search1[i])
}
delete.index1 <- unlist(delete.index1)
delete.index1
sample <- sample[-c(delete.index1)]
metadata <- metadata[-c(delete.index1),]
names <- list.files(pattern = '.CSV')
spectra.list <- lapply(names, read.csv, header = F)
wavenumbers <- unlist(spectra.list[[1]][1])
spectra.list2 <- lapply(spectra.list, '[', 2)
spectra.df <- as.data.frame(t(as.data.frame(spectra.list2)))
rownames(spectra.df) <- names
colnames(spectra.df) <- wavenumbers
# gsub('.{6}$', '', names)
names2 <- gsub('.{4}$', '', rownames(spectra.df))
names2[292:318] <- gsub('.{41}$', '', rownames(spectra.df)[292:318])
rownames(spectra.df) <- names
cols <- factor(gsub('.{2}$', '', names2))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra full range',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
colnames(spectra.df)[c(1,676)]
range1 <- spectra.df[,c(1:676)]
wavenumbers1 <- wavenumbers[c(1:676)]
for(i in  1:length(rownames(range1))){
plot(wavenumbers1,
range1[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra - ROI',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
search.vector <- unique(unlist(cols))
index <- list(106)
for (i in 1:106){
index[[i]] <- which(grepl(paste0('(?=.*',as.character(search.vector[i]),')'),
rownames(spectra.df),
perl=T
)
)
}
mean <- matrix(ncol= ncol(range1),
nrow = nrow(range1)/3)
# mean <- as.data.frame(mean)
colnames(mean) <- colnames(range1)
rownames(mean) <- search.vector
for(j in 1:length(colnames(range1))){
for(i in 1:length(rownames(mean))){
mean[i,j] <- mean(c(range1[index[[i]][1],j],
range1[index[[i]][2],j],
range1[index[[i]][3],j]
) )
}
}
mean <- as.data.frame(mean)
cols.means <- as.factor(search.vector)
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
mean[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'averaged spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
library(hyperSpec)
spc <- new('hyperSpec',
spc= mean,
wavelength = wavenumbers1)
bend <- 0.1 * wl.eval(spc,
function (x) x^6+x^5+x^4+x^3+x^2,
normalize.wl = normalize01)
bl <- spc.rubberband(spc+bend, noise = 1e-4, df = 20)-bend
suma <- spc+bend
spc3 <- spc - bl
plot(spc, wl.reverse = TRUE)
plot(bl, add=TRUE, col=2,wl.reverse = TRUE)
plot(suma,wl.reverse = TRUE)
plot(bend, add=TRUE, col=2,wl.reverse = TRUE)
plot(spc3,wl.reverse = TRUE)
corrected1  <- as.data.frame(spc3[1:106])
corrected <- as.data.frame(corrected1[,1])
par(mfrow = c(2,2))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra full range',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
for(i in  1:length(rownames(range1))){
plot(wavenumbers1,
range1[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra - ROI',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
mean[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'averaged spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
corrected[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.1),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'corrected spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
library(readxl)
metadata <- read_excel("metadata.xlsx")
sample <- unlist(na.omit(metadata$sample))
sample <- as.character(sample)
search1 <- as.character(c(131,149,161,164,167))
index1 <- list(5)
for(i in 1:5){
index1[[i]] <- which(grepl(paste0('(?=.*',search1[i],')'),rownames(mean),perl = T))
}
index1
sample2 <- sample[-c(delete.index1)]
delete.index1 <- list(5)
for(i in 1:5){
delete.index1[i] <- which(sample == search1[i])
}
delete.index1 <- unlist(delete.index1)
delete.index1
sample2 <- sample[-c(delete.index1)]
metadata2 <- metadata[-c(delete.index1),]
which(rownames(mean) == '214' |rownames(mean) == '216')
mean2 <- mean[-c(74,75),]
print(rownames(mean)[-c(96:104)])# We remove protobind
print(sample)
print(rownames(mean2)[-c(96:104)])# We remove protobind
print(sample)
print(rownames(mean2)[-c(96:105)])# We remove protobind
print(sample)
print(rownames(mean2)[-c(96:106)])# We remove protobind
print(sample)
rownames(mean2)
print(rownames(mean2)[-c(96:105)])# We remove protobind
print(sample)
print(rownames(mean2)[-c(96:105)])# We remove protobind
print(sample)
class <- unlist((metadata$class))
which(is.na(class))
metadata$sample[which(is.na(class))]
metadata <- metadata[-c(which(is.na(class))),]
ask<-list(81)
for(i in 1:81){
ask[[i]] <- which(
grepl(
paste0('(?=.*',
as.character(metadata$sample)[i],
')'
),
rownames(mean),
perl = T
)
)
}
ask <- unlist(ask)
meta.means <- mean[ask,]
rownames(meta.means)
as.character(metadata$sample)
names <- list.files(pattern = '.CSV')
spectra.list <- lapply(names, read.csv, header = F)
wavenumbers <- unlist(spectra.list[[1]][1])
spectra.list2 <- lapply(spectra.list, '[', 2)
spectra.df <- as.data.frame(t(as.data.frame(spectra.list2)))
rownames(spectra.df) <- names
colnames(spectra.df) <- wavenumbers
# gsub('.{6}$', '', names)
names2 <- gsub('.{4}$', '', rownames(spectra.df))
names2[292:318] <- gsub('.{41}$', '', rownames(spectra.df)[292:318])
rownames(spectra.df) <- names
cols <- factor(gsub('.{2}$', '', names2))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra full range',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
colnames(spectra.df)[c(1,676)]
range1 <- spectra.df[,c(1:676)]
wavenumbers1 <- wavenumbers[c(1:676)]
for(i in  1:length(rownames(range1))){
plot(wavenumbers1,
range1[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra - ROI',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
search.vector <- unique(unlist(cols))
index <- list(106)
for (i in 1:106){
index[[i]] <- which(grepl(paste0('(?=.*',as.character(search.vector[i]),')'),
rownames(spectra.df),
perl=T
)
)
}
mean <- matrix(ncol= ncol(range1),
nrow = nrow(range1)/3)
# mean <- as.data.frame(mean)
colnames(mean) <- colnames(range1)
rownames(mean) <- search.vector
for(j in 1:length(colnames(range1))){
for(i in 1:length(rownames(mean))){
mean[i,j] <- mean(c(range1[index[[i]][1],j],
range1[index[[i]][2],j],
range1[index[[i]][3],j]
) )
}
}
mean <- as.data.frame(mean)
cols.means <- as.factor(search.vector)
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
mean[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'averaged spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
library(hyperSpec)
spc <- new('hyperSpec',
spc= mean,
wavelength = wavenumbers1)
bend <- 0.1 * wl.eval(spc,
function (x) x^6+x^5+x^4+x^3+x^2,
normalize.wl = normalize01)
bl <- spc.rubberband(spc+bend, noise = 1e-4, df = 20)-bend
suma <- spc+bend
spc3 <- spc - bl
plot(spc, wl.reverse = TRUE)
plot(bl, add=TRUE, col=2,wl.reverse = TRUE)
plot(suma,wl.reverse = TRUE)
plot(bend, add=TRUE, col=2,wl.reverse = TRUE)
plot(spc3,wl.reverse = TRUE)
corrected1  <- as.data.frame(spc3[1:106])
corrected <- as.data.frame(corrected1[,1])
par(mfrow = c(2,2))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra full range',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
for(i in  1:length(rownames(range1))){
plot(wavenumbers1,
range1[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'raw spectra - ROI',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
mean[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.2),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'averaged spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
corrected[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.1),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = 'corrected spectra',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='absorbance (a.u.)')
library(readxl)
metadata <- read_excel("metadata.xlsx")
sample <- unlist(na.omit(metadata$sample))
sample <- as.character(sample)
search1 <- as.character(c(131,149,161,164,167))
index1 <- list(5)
for(i in 1:5){
index1[[i]] <- which(grepl(paste0('(?=.*',search1[i],')'),rownames(mean),perl = T))
}
index1
delete.index1 <- list(5)
for(i in 1:5){
delete.index1[i] <- which(sample == search1[i])
}
delete.index1 <- unlist(delete.index1)
delete.index1
sample2 <- sample[-c(delete.index1)]
metadata2 <- metadata[-c(delete.index1),]
which(rownames(mean) == '214' |rownames(mean) == '216')
mean2 <- mean[-c(74,75),]
print(rownames(mean2)[-c(96:105)])# We remove protobind
print(sample)
library(readxl)
metadata <- read_excel("metadata.xlsx")
View(metadata)
rownames(corrected)
