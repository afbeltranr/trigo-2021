text(coord[,1],
coord[,2],
metadata.si$sample,
cex=0.4,
pos=1)
library(mdatools)
wheatPLS <-
pls(Sispectra[,gen$bestsets[8,]],
SiTable$Si,
10,
cv =1)
plot(wheatPLS)
Sispectra <- as.matrix(Sispectra)
AllPLSSiTable <- data.frame(I(SiTable$Si),I(Sispectra))
library(pls) # Se asegura de cargar la libraría necesaria para realizar los cálculos de pls.
SiAllPLSplsr <- plsr(SiTable.Si~Sispectra[,gen$bestsets[8,]],ncomp=10,data=AllPLSSiTable,validation="LOO",scale=F) # Realiza el "pls" a los datos previamente acondicionados.
predictedvalues <- predict(SiAllPLSplsr,ncomp = 2,newdata = Sispectra[,gen$bestsets[8,]])
plot(SiTable$Si, predictedvalues [,1,1],main="") # Si
model <- lm(predictedvalues~SiTable$Si)
abline(a= 9113.6429,b=0.3607,col=2)
leaves.index <- which(
grepl(
paste0('(?=.*',
'L',
')'),
metadata$class,perl = T))
leaves.index
metadata.leaves <- metadata[leaves.index,]
which(is.na(metadata.leaves$Si))
which(is.na(metadata.leaves$spectra))
metadata.leaves$sample[11]
metadata.leaves.Si <-
metadata.leaves[-c(11),]
LeavesSi <-
cbind(
metadata.leaves.Si$sample,
metadata.leaves.Si$Si)
leavesSiSpectra <- corrected[metadata.leaves.Si$spectra.index,]
leavesSiSpectraRaw <- mean[metadata.leaves.Si$spectra.index,]
par(mfrow = c(1,2))
for (i in 1:length(
rownames(leavesSiSpectraRaw )
)
){
plot(as.numeric(
colnames(leavesSiSpectraRaw )
),
leavesSiSpectraRaw [i,],
xlab = '',
ylab = '',
axes = F,
type = 'l',
xlim = c(1700,400),
ylim = c(0,0.1))
par(new = T)
}
box()
axis(1)
axis(2)
title(main = '',
xlab = expression(
paste(
'Wave number (cm'^'-1',
')'
)
),
ylab = 'Absorbance (a.u.)')
par(new = F)
for (i in 1:length(
rownames(leavesSiSpectra)
)
){
plot(as.numeric(
colnames(leavesSiSpectra)
),
leavesSiSpectra[i,],
xlab = '',
ylab = '',
axes = F,
type = 'l',
xlim = c(1700,400),
ylim = c(0,0.1))
par(new = T)
}
box()
axis(1)
axis(2)
title(main = '',
xlab = expression(
paste(
'Wave number (cm'^'-1',
')'
)
),
ylab = 'Absorbance (a.u.)')
leavesSiSpectra <-
as.matrix(leavesSiSpectra)
SiTable <-
data.frame(Si = I(metadata.leaves.Si$Si),
spectra = I(leavesSiSpectra) )
newRange <-
leavesSiSpectra[,c(261:676)]
colnames( leavesSiSpectra[,c(261,676)])
library(mdatools)
LeavesPLS <- pls(leavesSiSpectra,
SiTable$Si,
10,
cv =1)
summary(LeavesPLS)
summary(LeavesPLS$res$cal)
plot(LeavesPLS)
par(mfrow=c(2,2))
plotXVariance(LeavesPLS)
plotXCumVariance(LeavesPLS)
plotYVariance(LeavesPLS)
plotYCumVariance(LeavesPLS)
library(subselect)
Hmat <- lmHmat(leavesSiSpectra,
metadata.leaves.Si$Si)
gen <- genetic(Hmat$mat,
kmin =5,
kmax = 16,
H= Hmat$H,
r =1,
crit = 'CCR12',
force = T)
par(mfrow=c(3,3))
for(j in 1:nrow(gen$bestsets)){
for (i in 1:length(rownames(leavesSiSpectra))){
plot(as.numeric(colnames(leavesSiSpectra)),
leavesSiSpectra[i,],
xlab = '',
ylab = '',
axes = F,
type = 'l',
xlim = c(1700,400),
ylim = c(0,0.06))
par(new = T)
}
box()
axis(1)
axis(2)
title(main = paste(
as.character(c(4:15)[j]),
'variables'),
xlab = expression(
paste('Wave number (cm'^'-1',')')),
ylab = 'Absorbance (a.u.)')
abline(v = as.numeric(
colnames(
leavesSiSpectra
)[gen$bestsets[j,]]),
col = 2,
lty = 2)
}
library(mdatools)
LeavesPLS <-
pls(leavesSiSpectra[,gen$bestsets[4,]],
SiTable$Si,
10,
cv =1)
plot(LeavesPLS)
means1 <- mean[metadata.leaves.Si$spectra.index,]
tiff('./plots/meansFullRange.tiff',
width = 4320,
height = 3240,
res = 800
)
par(mfrow = c(1,3))
for(i in  1:length(rownames(means1))){
plot(wavenumbers1,
means1[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(0,0.105),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at = c(1700, 1500, 1300, 1100, 900, 700, 500))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
tiff('./plots/meansFullRange.tiff',
width = 4320,
height = 3240,
res = 800
)
# par(mfrow = c(1,3))
for(i in  1:length(rownames(means1))){
plot(wavenumbers1,
means1[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(0,0.105),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at = c(1700, 1500, 1300, 1100, 900, 700, 500))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
plot(spc[metadata.leaves.Si$spectra.index],
wl.reverse = TRUE)
plot(bl[metadata.leaves.Si$spectra.index], add=TRUE, col=2,wl.reverse = TRUE)
box()
plot(spc3[metadata.leaves.Si$spectra.index],wl.reverse = TRUE)
box()
dev.off()
tiff('./plots/meansFullRange.tiff',
width = 4320,
height = 3240,
res = 800
)
# par(mfrow = c(1,3))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers1,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(0,0.105),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at = c(1700, 1500, 1300, 1100, 900, 700, 500))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
tiff('./plots/meansFullRange.tiff',
width = 4320,
height = 3240,
res = 800
)
# par(mfrow = c(1,3))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(0,0.105),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at = c(1700, 1500, 1300, 1100, 900, 700, 500))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(0,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at = c(1700, 1500, 1300, 1100, 900, 700, 500))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(-0.05,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at = c(1700, 1500, 1300, 1100, 900, 700, 500))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(-0.005,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at = c(1700, 1500, 1300, 1100, 900, 700, 500))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
seq(4500,500, by = 200)
seq(4500,500,200)
seq(500,4500,200)
rev(seq(500,4500,200))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(-0.005,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at =  rev(seq(500,4500,200)))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
tiff('./plots/meansFullRange.tiff',
width = 4320,
height = 3240,
res = 800
)
# par(mfrow = c(1,3))
for(i in  1:length(rownames(spectra.df))){
plot(wavenumbers,
spectra.df[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(-0.005,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at =  rev(seq(500,4500,200)))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
## mean spectra ROI
tiff('./plots/means.tiff',
width = 4320,
height = 3240,
res = 800
)
means1 <- mean[metadata.leaves.Si$spectra.index,]
for(i in  1:length(rownames(means1 ))){
plot(wavenumbers1,
means1 [i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(4000, 445),
ylim= c(-0.005,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at =  rev(seq(500,1700,200)))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
tiff('./plots/means.tiff',
width = 4320,
height = 3240,
res = 800
)
means1 <- mean[metadata.leaves.Si$spectra.index,]
for(i in  1:length(rownames(means1 ))){
plot(wavenumbers1,
means1 [i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 445),
ylim= c(-0.005,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at =  rev(seq(500,1700,200)))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
means1 <- mean[metadata.leaves.Si$spectra.index,]
## mean spectra ROI
tiff('./plots/means.tiff',
width = 4320,
height = 3240,
res = 800
)
for(i in  1:length(rownames(mean))){
plot(wavenumbers1,
mean[i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 400),
ylim= c(0,0.135309),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
box()
axis(1)
axis(2)
title(main = '',
xlab = expression(
paste('Wave number (cm'^'-1',
')')
),
ylab ='absorbance (a.u.)')
dev.off()
## Mean spectra ROI leaves samples with Si content
tiff('./plots/meansLeavesSi.tiff',
width = 4320,
height = 3240,
res = 800
)
means1 <- mean[metadata.leaves.Si$spectra.index,]
for(i in  1:length(rownames(means1 ))){
plot(wavenumbers1,
means1 [i,],
axes = F,
xlab = '',
ylab = '',
xlim = c(1700, 445),
ylim= c(-0.005,0.12),
type = 'l',
col =cols.means[i]
)
par(new = T)
}
axis(1, at =  rev(seq(500,1700,200)))
axis(2)
box()
title(main = '',
xlab = expression(paste('Wave number (cm'^'-1',')')),
ylab ='Absorbance (a.u.)')
dev.off()
tiff('./plots/baselineCorrection.tiff',
width = 12960,
height = 3240,
res = 800)
plot(spc[metadata.leaves.Si$spectra.index],
wl.reverse = TRUE)
plot(bl[metadata.leaves.Si$spectra.index], add=TRUE, col=2,wl.reverse = TRUE)
box()
plot(spc3[metadata.leaves.Si$spectra.index],wl.reverse = TRUE)
box()
dev.off()
tiff('./plots/baselineCorrection.tiff',
width = 4320,
height = 3240,
res = 800)
plot(spc[metadata.leaves.Si$spectra.index],
wl.reverse = TRUE)
plot(bl[metadata.leaves.Si$spectra.index], add=TRUE, col=2,wl.reverse = TRUE)
box()
plot(spc3[metadata.leaves.Si$spectra.index],wl.reverse = TRUE)
box()
dev.off()
